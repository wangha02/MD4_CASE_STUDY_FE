<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js"
            integrity="sha512-aVKKRRi/Q/YV+4mjoKBsE4x3H+BkegoM/em46NNlCqNTmUYADjBbeNefNxYV7giUp0VxICtqdrbqU7iVaeZNXA=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="../fragment/include.js"></script>
</head>
<body>
<table border="1">
    <p id="create" style="color: coral"></p>
    <tr>
        <td>url</td>
        <td><input type="file" id="file">
            <input type="text" id="urlFile">
            <progress id="progress"></progress>
        </td>
    </tr>
    <tr>
        <td>name</td>
        <td><input type="text" id="nameFile"></td>
    </tr>

    <tr>
        <td>view</td>
        <td><input type="number" id="viewFile"></td>
    </tr>
    <tr>
        <td>rate</td>
        <td><input type="text"id="rateFile"></td>
    </tr>
    <tr>
        <td><button id="button">create</button></td>
        <td><a href="/file/list.html">back</a></td>
    </tr>
</table>
<script type="module">
    import {Firebase} from "./filebase.js";

    const firebase = new Firebase();

    // Set information
    firebase.setProgress('#progress');
    firebase.setDownloadUrl('#urlFile')

    const input = $('#file')

    // Upload file when input
    input.change(function () {
        // Get file
        let data = input.prop('files')
        let file = data[0];

        firebase.setLocation('/file/' + file.name);
        firebase.upload(file);

    });

</script>
<script>
    $(document).ready(function (){
        $('#button').click(function (){
            let file = {
                url:$('#urlFile').val(),
                name:$('#nameFile').val(),
                view:$('#viewFile').val(),
                rate:$('#rateFile').val(),
            }
            console.log(JSON.stringify(file))
            $.ajax({
                url: 'https://storymd4.herokuapp.com/api/comic',
                method:'POST',
                headers:{
                    Authorization: "Bearer " + window.localStorage.getItem('TOKEN_KEY')
                },
                contentType:'application/Json; charset=UTF-8',
                data:JSON.stringify(file),
                success:function (){
                    document.getElementById('create').innerHTML = "create success!";
                    return;
                },
                error:function (){
                    document.getElementById('create').innerHTML = "video invalid"
                }
            })
        })
    })
</script>
</body>
</html>